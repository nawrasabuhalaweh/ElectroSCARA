import time
import cv2
import serial
import scara_config as sc
import scara_serial as ss
import scara_kinematics as sk
import scara_vision as sv

scara = serial.Serial('COM3', baudrate=250000, timeout=1)
time.sleep(2)

firstXSteps = sk.getAbsStepsX(250, 300, sc.l1, sc.l2)
firstYSteps = sk.getAbsStepsY(250, 300, sc.l1, sc.l2)

ss.writeScara(scara, firstXSteps, firstYSteps, sc.feed)


cap = cv2.VideoCapture(1)

while True:
    objPos = sv.readFrame(cap)
    objPosX = objPos[0]
    objPosY = objPos[1]

    newPos = sk.getRelSteps(objPosX, objPosY, firstXSteps, firstYSteps, sc.l1, sc.l2)
    newPosX = newPos[0]
    newPosY = newPos[1]

    ss.writeScara(scara, newPosX, newPosY, sc.feed)
    time.sleep(2)
    ss.writeScara(scara, -newPosX, -newPosY, sc.feed)
    time.sleep(2)



